diff -urN package/proftpd/proftpd-1.3.1-deparallelize_make.patch package/proftpd.NEW/proftpd-1.3.1-deparallelize_make.patch
--- package/proftpd/proftpd-1.3.1-deparallelize_make.patch	2013-01-16 21:05:16.008161771 -0800
+++ package/proftpd.NEW/proftpd-1.3.1-deparallelize_make.patch	1969-12-31 16:00:00.000000000 -0800
@@ -1,11 +0,0 @@
---- proftpd-1.3.1/Makefile.in.ORIG	2007-01-16 12:58:10.000000000 -0700
-+++ proftpd-1.3.1/Makefile.in	2011-08-10 19:08:09.000000000 -0600
-@@ -24,6 +24,8 @@
- 
- all: $(BUILD_BIN)
- 
-+.NOTPARALLEL:
-+
- include/buildstamp.h:
- 	echo \#define BUILD_STAMP \"`date`\" >include/buildstamp.h
- 
diff -urN package/proftpd/proftpd-1.3.1-fix-kernel-header-capability-version.patch package/proftpd.NEW/proftpd-1.3.1-fix-kernel-header-capability-version.patch
--- package/proftpd/proftpd-1.3.1-fix-kernel-header-capability-version.patch	2008-06-20 00:15:58.000000000 -0700
+++ package/proftpd.NEW/proftpd-1.3.1-fix-kernel-header-capability-version.patch	1969-12-31 16:00:00.000000000 -0800
@@ -1,12 +0,0 @@
---- a/lib/libcap/libcap.h	2008-04-24 19:46:29.475883739 +0200
-+++ b/lib/libcap/libcap.h	2008-04-24 19:48:31.116088563 +0200
-@@ -52,7 +52,8 @@
-  */
- 
- #if !defined(_LINUX_CAPABILITY_VERSION) || \
--            (_LINUX_CAPABILITY_VERSION != 0x19980330)
-+           ((_LINUX_CAPABILITY_VERSION != 0x19980330) && \
-+            (_LINUX_CAPABILITY_VERSION != 0x20071026))
- 
- # error "Kernel <linux/capability.h> does not match library"
- # error "file "libcap.h" --> fix and recompile libcap"
diff -urN package/proftpd/proftpd-1.3.4b-001-deparallelize_make.patch package/proftpd.NEW/proftpd-1.3.4b-001-deparallelize_make.patch
--- package/proftpd/proftpd-1.3.4b-001-deparallelize_make.patch	1969-12-31 16:00:00.000000000 -0800
+++ package/proftpd.NEW/proftpd-1.3.4b-001-deparallelize_make.patch	2013-01-16 21:05:16.008161771 -0800
@@ -0,0 +1,11 @@
+--- proftpd-1.3.1/Makefile.in.ORIG	2007-01-16 12:58:10.000000000 -0700
++++ proftpd-1.3.1/Makefile.in	2011-08-10 19:08:09.000000000 -0600
+@@ -24,6 +24,8 @@
+ 
+ all: $(BUILD_BIN)
+ 
++.NOTPARALLEL:
++
+ include/buildstamp.h:
+ 	echo \#define BUILD_STAMP \"`date`\" >include/buildstamp.h
+ 
diff -urN package/proftpd/proftpd-1.3.4b-002-mempcpy.patch package/proftpd.NEW/proftpd-1.3.4b-002-mempcpy.patch
--- package/proftpd/proftpd-1.3.4b-002-mempcpy.patch	1969-12-31 16:00:00.000000000 -0800
+++ package/proftpd.NEW/proftpd-1.3.4b-002-mempcpy.patch	2013-01-16 20:37:50.297156492 -0800
@@ -0,0 +1,12 @@
+diff -urN proftpd-1.3.4b.ORIG/lib/pr_fnmatch.c proftpd-1.3.4b/lib/pr_fnmatch.c
+--- proftpd-1.3.4b.ORIG/lib/pr_fnmatch.c	2012-04-24 12:21:01.000000000 -0700
++++ proftpd-1.3.4b/lib/pr_fnmatch.c	2013-01-16 20:10:38.704157824 -0800
+@@ -250,7 +250,7 @@
+ # endif
+ # define STRLEN(S) strlen (S)
+ # define STRCAT(D, S) strcat (D, S)
+-# define MEMPCPY(D, S, N) __mempcpy (D, S, N)
++# define MEMPCPY(D, S, N) mempcpy (D, S, N)
+ # define MEMCHR(S, C, N) memchr (S, C, N)
+ # define STRCOLL(S1, S2) strcoll (S1, S2)
+ # include "pr_fnmatch_loop.c"
diff -urN package/proftpd/proftpd.mk package/proftpd.NEW/proftpd.mk
--- package/proftpd/proftpd.mk	2013-01-16 21:05:16.008161771 -0800
+++ package/proftpd.NEW/proftpd.mk	2013-01-16 20:02:17.554155837 -0800
@@ -3,25 +3,36 @@
 # proftpd
 #
 #############################################################
-PROFTPD_VERSION:=1.3.1
-PROFTPD_SOURCE:=proftpd-$(PROFTPD_VERSION).tar.bz2
+PROFTPD_VERSION:=1.3.4b
+PROFTPD_SOURCE:=proftpd-$(PROFTPD_VERSION).tar.gz
 PROFTPD_SITE:=ftp://ftp.proftpd.org/distrib/source/
 PROFTPD_DIR:=$(BUILD_DIR)/proftpd-$(PROFTPD_VERSION)
-PROFTPD_CAT:=$(BZCAT)
+PROFTPD_CAT:=$(ZCAT)
 PROFTPD_BINARY:=proftpd
 PROFTPD_TARGET_BINARY:=usr/sbin/proftpd
 
+PROFTPD_MOD_VROOT_VERSION:=0.9.2
+PROFTPD_MOD_VROOT_SOURCE:=proftpd-mod-vroot-$(PROFTPD_MOD_VROOT_VERSION).tar.gz
+PROFTPD_MOD_VROOT_SITE:=http://www.castaglia.org/proftpd/modules/
+PROFTPD_MOD_VROOT_CAT:=$(ZCAT)
+
 ifeq ($(BR2_INET_IPV6),y)
 ENABLE_IPV6:=--enable-ipv6
+else
+ENABLE_IPV6:=--disable-ipv6
 endif
 
 $(DL_DIR)/$(PROFTPD_SOURCE):
 	 $(WGET) -P $(DL_DIR) $(PROFTPD_SITE)/$(PROFTPD_SOURCE)
 
-proftpd-source: $(DL_DIR)/$(PROFTPD_SOURCE)
+$(DL_DIR)/$(PROFTPD_MOD_VROOT_SOURCE):
+	 $(WGET) -P $(DL_DIR) $(PROFTPD_MOD_VROOT_SITE)/$(PROFTPD_MOD_VROOT_SOURCE)
+
+proftpd-source: $(DL_DIR)/$(PROFTPD_SOURCE) $(DL_DIR)/$(PROFTPD_MOD_VROOT_SOURCE)
 
 $(PROFTPD_DIR)/.unpacked: $(DL_DIR)/$(PROFTPD_SOURCE)
 	$(PROFTPD_CAT) $(DL_DIR)/$(PROFTPD_SOURCE) | tar -C $(BUILD_DIR) $(TAR_OPTIONS) -
+	$(PROFTPD_MOD_VROOT_CAT) $(DL_DIR)/$(PROFTPD_MOD_VROOT_SOURCE) | tar -C $(PROFTPD_DIR)/contrib --strip-components 1 $(TAR_OPTIONS) - mod_vroot/mod_vroot.c
 	$(CONFIG_UPDATE) $(PROFTPD_DIR)
 	toolchain/patch-kernel.sh $(PROFTPD_DIR) package/proftpd/ proftpd-$(PROFTPD_VERSION)\*.patch;
 	touch $@
@@ -48,6 +59,7 @@
 		$(DISABLE_LARGEFILE) \
 		$(ENABLE_IPV6) \
 		--with-gnu-ld \
+		--with-modules=mod_vroot \
 	)
 	touch $@
 
